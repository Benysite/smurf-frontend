<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <title>SmurfDetector ‚Äî Accueil</title>
    <link rel="stylesheet" href="style.css" />
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>

<header class="valo-header">
    <div class="logo-wrapper">
        <img src="assets/logo.png" class="valo-logo">
        <h1 class="title"><span class="accent">SMURF</span>DETECTOR</h1>
    </div>

    <nav class="valo-nav">
        <a href="index.html">Analyse</a>
        <a href="leaderboard.html">Leaderboard</a>
        <a href="stats.html">Stats</a>
    </nav>
</header>

<section class="hero">
    <div class="hero-content">
        <h2>D√©tecte les Smurfs sur Valorant</h2>
        <p>Analyse instantan√©e bas√©e sur les performances r√©elles du joueur.</p>

        <div class="hero-input">
            <input type="text" id="pseudo" placeholder="Entrez un pseudo (ex: Beny)">
            <button onclick="analyze()">Analyser</button>
        </div>
    </div>

    <div class="hero-overlay"></div>
</section>

<div class="container">
    <div id="result" class="result-panel"></div>

    <div id="loader" class="valo-loader" aria-hidden="true" style="display:none;">
        <div class="v-ring"></div>
        <div class="bars"><span></span><span></span><span></span><span></span></div>
        <p>Analyse en cours‚Ä¶</p>
    </div>

    <div class="section-title">
        Pourquoi utiliser <span>SmurfDetector</span> ?
    </div>

    <section class="features">
        <div class="feature-card">
            <h3>Analyse KD avanc√©e</h3>
            <p>Analyse du comportement statistique et du ratio K/D sur plusieurs parties.</p>
        </div>

        <div class="feature-card">
            <h3>Smurf Score</h3>
            <p>Un score de suspicion unique bas√© sur plusieurs param√®tres de performance.</p>
        </div>

        <div class="feature-card">
            <h3>Historique complet</h3>
            <p>Visualisation de l‚Äô√©volution du joueur : kills, KD, score et tendances.</p>
        </div>
    </section>

    <section class="cta-section">
        <h2>Pr√™t √† analyser ton prochain match ?</h2>
        <button onclick="scrollToTop()">Commencer maintenant</button>
    </section>
</div>
<script>
console.log("Script charg√©.");

function scrollToTop() {
    window.scrollTo({ top: 0, behavior: "smooth" });
}

function showError(msg) {
    document.getElementById("loader").style.display = "none";
    const box = document.getElementById("result");
    box.style.display = "block";
    box.innerHTML = `
        <p style="color:#ff4f91; text-align:center; font-size:20px; padding:20px;">
            ${msg}
        </p>`;
}

// üî• Calcul du rang selon le KD
function getRankFromStats(data) {
    const kd = data.averages.kd;

    if (kd < 0.7) return "iron1";
    if (kd < 0.9) return "iron2";
    if (kd < 1.0) return "iron3";

    if (kd < 1.1) return "bronze1";
    if (kd < 1.2) return "bronze2";
    if (kd < 1.3) return "bronze3";

    if (kd < 1.4) return "argent1";
    if (kd < 1.5) return "argent2";
    if (kd < 1.6) return "argent3";

    if (kd < 1.7) return "or1";
    if (kd < 1.9) return "or2";
    if (kd < 2.1) return "or3";

    if (kd < 2.3) return "platine1";
    if (kd < 2.5) return "platine2";
    if (kd < 2.7) return "platine3";

    if (kd < 3.0) return "diamant1";
    if (kd < 3.3) return "diamant2";
    if (kd < 3.6) return "diamant3";

    if (kd < 4.0) return "ascendant1";
    if (kd < 4.5) return "ascendant2";
    if (kd < 5.0) return "ascendant3";

    if (kd < 6.0) return "immortel1";
    if (kd < 7.0) return "immortel2";
    if (kd < 8.0) return "immortel3";

    return "radiant";
}


// üî• Analyse du pseudo
async function analyze() {

    console.log("Analyse lanc√©e !");

    const pseudo = document.getElementById("pseudo").value.trim();
    if (!pseudo) return;

    const loader = document.getElementById("loader");
    const box = document.getElementById("result");

    box.style.display = "none";
    box.innerHTML = "";
    loader.style.display = "flex";

    try {
        const API = "https://smurf-backend-yg7w.onrender.com";
        const url = `${API}/stats/player/${encodeURIComponent(pseudo)}/smurf-check`;

        const response = await fetch(url);
        if (!response.ok) return showError("Erreur de connexion au serveur.");

        const data = await response.json();
        loader.style.display = "none";

        if (!data || data.message === "Aucune donn√©e trouv√©e")
            return showError("Pseudo introuvable üîé");

        const rank = getRankFromStats(data);

        box.style.display = "block";
        box.innerHTML = `
            <h3>R√©sultat pour ${data.player}</h3>

            <img src="assets/ranks/${rank}.png"
                 class="rank-icon"
                 style="width:130px; display:block; margin:10px auto;">

            <div class="separator"></div>

            <p><strong>Smurf Score :</strong> ${data.suspicionScore}/100</p>
            <div class="progress">
                <div class="progress-bar" style="width:${data.suspicionScore}%"></div>
            </div>

            <div class="separator"></div>

            <p><strong>Verdict :</strong> ${data.verdict}</p>
            <p><strong>KD Moyen :</strong> ${data.averages.kd.toFixed(2)}</p>
            <p><strong>Kills moyens :</strong> ${data.averages.avgKills.toFixed(1)}</p>
            <p><strong>Deaths moyennes :</strong> ${data.averages.avgDeaths.toFixed(1)}</p>
            <p><strong>Score moyen :</strong> ${data.averages.avgScore.toFixed(0)}</p>

            <div class="separator"></div>

            <h3>Historique</h3>
            <canvas id="historyChart" height="80"></canvas>

            <div class="separator"></div>

            ${data.reasons?.length
                ? `<h3>Raisons</h3><ul>${data.reasons.map(r => `<li>${r}</li>`).join("")}</ul>`
                : ""}
        `;

        drawHistoryChart(data.history);

    } catch (err) {
        showError("Erreur de connexion au serveur.");
    }
}


// üî• Graphique historique
function drawHistoryChart(history) {
    const ctx = document.getElementById("historyChart").getContext("2d");

    new Chart(ctx, {
        type: "line",
        data: {
            labels: history.map((h, i) => "Match " + (i + 1)),
            datasets: [
                {
                    label: "Kills",
                    data: history.map(h => h.kills),
                    borderColor: "#ff4f91",
                    borderWidth: 2,
                    tension: 0.3
                },
                {
                    label: "Deaths",
                    data: history.map(h => h.deaths),
                    borderColor: "#4f91ff",
                    borderWidth: 2,
                    tension: 0.3
                }
            ]
        },
        options: {
            scales: { y: { beginAtZero: true } },
            plugins: { legend: { labels: { color: "#fff" } } }
        }
    });
}
</script>



</body>
</html>
