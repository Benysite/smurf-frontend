<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <title>SmurfDetector â€” Leaderboard</title>
    <link rel="stylesheet" href="style.css" />
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">
</head>

<body>

<header class="valo-header">
    <div class="logo-wrapper">
        <img src="assets/logo.png" class="valo-logo">
        <h1 class="title"><span class="accent">SMURF</span>DETECTOR</h1>
    </div>

    <nav class="valo-nav">
        <a href="index.html">Analyse</a>
        <a href="leaderboard.html">Leaderboard</a>
        <a href="stats.html">Stats</a>
    </nav>
</header>

<div class="container">
    <h1>Classements</h1>

    <div class="card">
        <h2>ðŸ”¥ Top Smurf Score</h2>
        <div id="smurfTable">Chargementâ€¦</div>
    </div>

    <div class="card">
        <h2>ðŸ’€ Meilleurs KD</h2>
        <div id="kdTable">Chargementâ€¦</div>
    </div>

    <div class="card">
        <h2>ðŸŽ¯ Meilleur Score Moyen</h2>
        <div id="scoreTable">Chargementâ€¦</div>
    </div>

    <div class="card">
        <h2>ðŸ©¸ Meilleur Kills Moyen</h2>
        <div id="killsTable">Chargementâ€¦</div>
    </div>

</div>

<script>
const API = "https://smurf-backend-yg7w.onrender.com";

function renderTable(container, rows) {
    container.innerHTML = `
        <table>
            <thead>
                <tr>
                    <th>Joueur</th>
                    <th>Verdict</th>
                    <th>Smurf Score</th>
                    <th>KD</th>
                    <th>Score Moyen</th>
                    <th>Kills Moyen</th>
                </tr>
            </thead>
            <tbody>
                ${rows.map(r => `
                    <tr>
                        <td>${r.player || r._id}</td>
                        <td>${r.verdict || "-"}</td>
                        <td>${r.suspicionScore ?? r.suspicion ?? "-"}</td>
                        <td>${r.kd ? r.kd.toFixed(2) : "-"}</td>
                        <td>${r.avgScore ? Math.round(r.avgScore) : "-"}</td>
                        <td>${r.avgKills ? r.avgKills.toFixed(1) : "-"}</td>
                    </tr>
                `).join("")}
            </tbody>
        </table>
    `;
}

(async () => {
    const s = await fetch(`${API}/stats/leaderboard/smurf`);
    const smurf = await s.json();
    renderTable(document.getElementById("smurfTable"), smurf.players);

    const g = await fetch(`${API}/stats/leaderboard/global`);
    const global = await g.json();
    const list = global.leaderboard;

    // KD FIX
    renderTable(document.getElementById("kdTable"), list);

    const byScore = [...list].sort((a,b) => b.avgScore - a.avgScore);
    renderTable(document.getElementById("scoreTable"), byScore);

    const byKills = [...list].sort((a,b) => b.avgKills - a.avgKills);
    renderTable(document.getElementById("killsTable"), byKills);
})();
</script>
